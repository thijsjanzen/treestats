<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Speed improvement â€¢ treestats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Speed improvement">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">treestats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.70.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Example_abc.html">Example: abc</a></li>
    <li><a class="dropdown-item" href="../articles/Example_data.html">Example: data</a></li>
    <li><a class="dropdown-item" href="../articles/Getting_started.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/Speed_improvement.html">Speed improvement</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/thijsjanzen/treestats/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Speed improvement</h1>
                        <h4 data-toc-skip class="author">Thijs
Janzen</h4>
            
            <h4 data-toc-skip class="date">2024-07-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/thijsjanzen/treestats/blob/main/vignettes/Speed_improvement.Rmd" class="external-link"><code>vignettes/Speed_improvement.Rmd</code></a></small>
      <div class="d-none name"><code>Speed_improvement.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="speed">Speed<a class="anchor" aria-label="anchor" href="#speed"></a>
</h2>
<p>An important goal during the development of treestats, has been to
provide not only a vast collection of phylogenetic tree statistics, but
also ensure that calculation of these statistics is fast and reliable.
During development, results of the developed code have continuously been
tested against reference code from other packages. After ensuring
correctness, profiling methods have been used to improve calculation
speed.</p>
<div class="section level3">
<h3 id="timing-the-relationship-with-tree-size">Timing the relationship with tree size<a class="anchor" aria-label="anchor" href="#timing-the-relationship-with-tree-size"></a>
</h3>
<p>Tree size is an important factor in determining calculation
performance. We have varied tree size from 10 to 1000 in logarithmicly
appropriate steps, calculating statistics for 10 randomly generated Yule
trees per tree size.</p>
<p><img src="https://github.com/thijsjanzen/treestats/blob/main/layout/Figure_S3.png?raw=true" width="100%"></p>
<p>Results show that for many statistics, treestats code provides a
serious speed improvement over the old R code. Furthermore, scaling with
tree size is much better (consider for instance mpd and mntd, which
scale exponentially with tree size using R, but linear with using
treestats). Two functions are faster in other packages: colless and
gamma. These two functions are slower in treestats due to additional
checks before performing the calculations, these checks verify whether
the tree is binary (for colless) or ultrametric (for the gamma
statistic).</p>
</div>
<div class="section level3">
<h3 id="worst-culprits">Worst culprits<a class="anchor" aria-label="anchor" href="#worst-culprits"></a>
</h3>
<p>There are three functions that require a considerably larger amount
of time to be calculated on a tree of 1000 tips, compared to all other
functions (see Figure below). These three functions rely on calculation
of the Eigen values of a (Laplacian) matrix. Unfortunately, calculating
Eigen values is a costly endeavour, and can not be further optimized
in-house - we use the base Eigen functions for that already.</p>
<p><img src="Speed_improvement_files/figure-html/unnamed-chunk-2-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="speed-improvement">Speed improvement<a class="anchor" aria-label="anchor" href="#speed-improvement"></a>
</h3>
<p>So how much does the speed improve for large trees? We see that for
many statistics, the speed improvement is at least a factor 10, with for
some statistics (mntd, mpd, psv) a speed improvement around four orders
of magnitude. Currently, for many functions speed is limited by
preliminary checks if the used tree is ultrametric and/or binary (if
required), and code converting a phy object to C++ objects.
Nevertheless, improvements are considerable and we hope that these
improvements in calculation speed allow for a broader application of
many summary statistics.</p>
<p><img src="https://github.com/thijsjanzen/treestats/blob/main/layout/Figure_S4.png?raw=true" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thijs Janzen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
